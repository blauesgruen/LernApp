<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LernApp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <style>
        .app-logo-button {
            cursor: pointer; /* Change cursor to pointer to indicate clickability */
            text-decoration: none; /* Ensure no underline is shown */
        }
        .btn {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .app-logo-button i {
            color: blue; /* Icon immer blau */
        }
        .app-logo-button span {
            color: black; /* Text immer schwarz */
        }
        /* Gemeinsame Stile für alle Menübuttons */
        #user-buttons a, .admin-button {
            margin-right: 15px; /* Abstand zwischen den Buttons */
            color: black; /* Textfarbe immer schwarz */
            text-decoration: none; /* Keine Unterstreichung */
            transition: color 0.3s ease; /* Weicher Übergang für Hover-Effekt */
        }
        #user-buttons a:hover, .admin-button:hover {
            color: #007bff; /* Dezente Farbänderung beim Hover */
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="app-logo-button" id="app-logo-button">
            <i class="fas fa-graduation-cap"></i>
            <span>LernApp</span>
        </a>
        <ul>
            <li><a href="admin.html" class="admin-button" id="admin-button">Admin</a></li>
            <li id="user-buttons" style="display: none;">
                <a href="dashboard.html" class="dashboard-button" id="dashboard-button">Dashboard</a>
                <a href="profile.html" class="profile-button" id="profile-button">Profil</a>
                <a href="#" class="logout-button" id="logout-button" onclick="handleLogout()">Ausloggen</a>
            </li>
        </ul>
        <div class="header-right"></div>
    </nav>    
    <script>
        // Logs persistent machen, auch nach Logout
        window.handleLogout = function() {
            try {
                // Zentrale Logging-Funktion verwenden, falls verfügbar
                const log = window.logMessage || console.log;
                
                // Nur relevante Daten aus localStorage entfernen, Logs bleiben erhalten
                const logs = localStorage.getItem('persistentLogs');
                localStorage.clear();
                if (logs) {
                    localStorage.setItem('persistentLogs', logs);
                }
                log('localStorage nach Logout: ' + JSON.stringify(localStorage));
                // Weiterleitung zur Startseite
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Fehler beim Logout:', error);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Zentrale Logging-Funktion verwenden, falls verfügbar
            const log = window.logMessage || console.log;
            
            log('DOMContentLoaded Event ausgelöst.');

            const adminButton = document.getElementById('admin-button');
            const userButtons = document.getElementById('user-buttons');
            const appLogoButton = document.getElementById('app-logo-button');
            const isLoggedIn = localStorage.getItem('loggedIn') === 'true';

            log('Überprüfe, ob adminButton existiert: ' + !!adminButton);
            log('Überprüfe, ob userButtons existiert: ' + !!userButtons);
            log('Login-Status: ' + isLoggedIn);

            if (adminButton) {
                log('Admin-Button gefunden. Setze Sichtbarkeit.');
                adminButton.style.display = isLoggedIn ? 'none' : 'block';
                log('Admin-Button Sichtbarkeit nach Änderung: ' + adminButton.style.display);
            } else {
                log('Admin-Button nicht gefunden.', 'error');
            }

            if (userButtons) {
                log('User-Buttons gefunden. Setze Sichtbarkeit.');
                userButtons.style.display = isLoggedIn ? 'block' : 'none';
                log('User-Buttons Sichtbarkeit nach Änderung: ' + userButtons.style.display);
            } else {
                log('User-Buttons Gruppe nicht gefunden.', 'error');
            }

            if (appLogoButton) {
                log('App-Logo-Button gefunden. Setze Link.');

                // Setze den Link basierend auf dem Login-Status
                if (isLoggedIn) {
                    appLogoButton.href = 'dashboard.html';
                    log('Benutzer ist eingeloggt. Link auf Dashboard gesetzt.');
                } else {
                    appLogoButton.href = 'index.html';
                    log('Benutzer ist nicht eingeloggt. Link auf Index gesetzt.');
                }

                log('App-Logo-Button Link nach Änderung: ' + appLogoButton.href);
            } else {
                log('App-Logo-Button nicht gefunden.', 'error');
            }

            log('DOM-Manipulation abgeschlossen.');
        });

        // Stellt sicher, dass showLogs global verfügbar ist
        window.showLogs = function() {
            const logs = JSON.parse(localStorage.getItem('persistentLogs')) || [];
            const logContainer = document.createElement('div');
            logContainer.style.padding = '10px';
            logContainer.style.margin = '10px';
            logContainer.style.border = '1px solid #ccc';
            logContainer.style.backgroundColor = '#f9f9f9';
            logContainer.style.maxHeight = '300px';
            logContainer.style.overflowY = 'scroll';

            logs.forEach(log => {
                const logEntry = document.createElement('p');
                logEntry.textContent = `${log.timestamp}: ${log.message}`;
                logContainer.appendChild(logEntry);
            });

            const headerRight = document.querySelector('.header-right');
            headerRight.appendChild(logContainer);
        };
    </script>
</body>
</html>
